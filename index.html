<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Skylog ‚Äî Aviation Photography</title>
  <meta name="description" content="Aviation photography gallery with map + lightbox." />
  <style>
    :root{
      --bg:#06070a;
      --panel:rgba(255,255,255,.06);
      --panel2:rgba(255,255,255,.04);
      --border:rgba(255,255,255,.10);
      --border2:rgba(255,255,255,.16);
      --text:#f5f6f8;
      --muted:rgba(245,246,248,.72);
      --muted2:rgba(245,246,248,.55);
      --shadow: 0 18px 55px rgba(0,0,0,.55);
      --r: 22px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: radial-gradient(700px 500px at 50% -10%, rgba(255,255,255,.09), transparent 60%),
                  radial-gradient(900px 700px at 110% 20%, rgba(255,255,255,.06), transparent 60%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
    }
    a{color:inherit}
    .wrap{max-width:1120px;margin:0 auto;padding:0 16px}
    .topbar{
      position:sticky;top:0;z-index:10;
      backdrop-filter: blur(10px);
      background: rgba(6,7,10,.70);
      border-bottom: 1px solid var(--border);
    }
    .topbar-inner{
      display:flex;align-items:center;justify-content:space-between;
      gap:12px;padding:12px 0;
    }
    .brand{
      display:flex;align-items:center;gap:12px;min-width:0;
    }
    .logo{
      width:40px;height:40px;border-radius:16px;
      display:grid;place-items:center;
      border:1px solid var(--border);
      background: var(--panel2);
    }
    .brand h1{margin:0;font-size:14px;letter-spacing:.2px}
    .brand p{margin:2px 0 0;font-size:12px;color:var(--muted2)}
    .nav{
      display:flex;align-items:center;gap:10px;flex-wrap:wrap;
    }
    .btn{
      border:1px solid var(--border);
      background: var(--panel2);
      color: var(--text);
      padding:10px 12px;
      border-radius: 16px;
      font-size:13px;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      display:inline-flex;gap:8px;align-items:center;
      text-decoration:none;
      user-select:none;
    }
    .btn:hover{background: rgba(255,255,255,.10);border-color: var(--border2)}
    .btn:active{transform: scale(.98)}
    .btn.primary{
      background: rgba(255,255,255,.12);
      border-color: rgba(255,255,255,.22);
    }

    .hero{padding:34px 0 14px}
    .hero-grid{
      display:grid;grid-template-columns: 1.2fr .8fr;
      gap:16px;align-items:start;
    }
    @media (max-width: 900px){
      .hero-grid{grid-template-columns: 1fr; }
    }
    .hero h2{
      margin:0;
      font-size:34px;
      line-height:1.12;
      letter-spacing:-.3px;
    }
    .hero .sub{
      margin:12px 0 0;
      color: var(--muted);
      max-width: 62ch;
      font-size:15px;
      line-height:1.5;
    }

    /* Runway divider */
    .runway{
      position:relative;
      height:42px;
      margin:18px 0 0;
      overflow:hidden;
      border-radius: 999px;
    }
    .runway::before{
      content:"";
      position:absolute;inset:0;
      background: linear-gradient(to right, transparent, rgba(255,255,255,.08), transparent);
      opacity:.7;
    }
    .runway .edge{
      position:absolute;left:0;right:0;top:50%;
      height:1px;background: rgba(255,255,255,.10);
      transform: translateY(-50%);
    }
    .runway .centerline{
      position:absolute;left:50%;top:50%;
      width:1200px;height:2px;
      transform: translate(-50%,-50%);
      background-image: linear-gradient(to right,
        transparent 0 8px,
        rgba(255,255,255,.40) 8px 22px,
        transparent 22px 34px
      );
      background-size: 34px 2px;
      opacity:.85;
    }
    .runway .marker{
      position:absolute;left:50%;top:50%;
      width:34px;height:34px;
      transform: translate(-50%,-50%);
      display:grid;place-items:center;
      border-radius: 16px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      box-shadow: 0 8px 22px rgba(0,0,0,.35);
      font-size:16px;
    }

    .panel{
      border:1px solid var(--border);
      background: var(--panel);
      border-radius: var(--r);
      box-shadow: var(--shadow);
    }
    .controls{padding:14px}
    .row{display:flex;gap:10px;align-items:center}
    .row.wrap{flex-wrap:wrap}
    .field{width:100%}
    label{display:block;font-size:12px;color:var(--muted2);margin:0 0 6px}
    input, select{
      width:100%;
      padding:11px 12px;
      border-radius: 16px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.25);
      color: var(--text);
      outline:none;
    }
    input::placeholder{color: rgba(245,246,248,.38)}
    input:focus,select:focus{border-color: rgba(255,255,255,.24)}
    .small{
      font-size:12px;color:var(--muted2)
    }
    .pillbar{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    .pill{
      border:1px solid var(--border);
      background: rgba(255,255,255,.05);
      padding:8px 10px;
      border-radius: 999px;
      font-size:12px;
      cursor:pointer;
      display:inline-flex;align-items:center;gap:8px;
      color: rgba(245,246,248,.92);
      transition: background .12s ease, border-color .12s ease;
    }
    .pill:hover{background: rgba(255,255,255,.09);border-color: var(--border2)}
    .pill.active{background: rgba(255,255,255,.12);border-color: rgba(255,255,255,.22)}
    .dot{width:8px;height:8px;border-radius:999px;display:inline-block}

    /* Tabs */
    .tabs{
      display:flex;gap:8px;flex-wrap:wrap;margin-top:14px
    }
    .tab{
      padding:10px 12px;border-radius:16px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.05);
      cursor:pointer;font-size:13px;
    }
    .tab.active{
      background: rgba(255,255,255,.11);
      border-color: rgba(255,255,255,.22);
    }

    /* Gallery */
    .main{padding: 12px 0 46px}
    .gallery{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:12px;
    }
    @media (max-width: 980px){ .gallery{grid-template-columns: repeat(2, 1fr);} }
    @media (max-width: 620px){ .gallery{grid-template-columns: 1fr;} }

    .card{
      position:relative;overflow:hidden;
      border-radius: 24px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.04);
      cursor:pointer;
      transition: transform .18s ease, border-color .18s ease, background .18s ease;
    }
    .card:hover{
      transform: translateY(-2px);
      border-color: rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
    }
    .thumb{
      width:100%;
      aspect-ratio: 4/3;
      object-fit: cover;
      display:block;
      transform: scale(1);
      transition: transform .30s ease;
    }
    .card:hover .thumb{transform: scale(1.02)}
    .stamp{
      position:absolute;left:10px;top:10px;z-index:2;
      padding:8px 10px;
      font-size:11px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.35);
      backdrop-filter: blur(6px);
      max-width: calc(100% - 20px);
      display:flex;align-items:center;gap:8px;
    }
    .stamp .beacon{width:6px;height:6px;border-radius:999px;background: rgba(255,255,255,.75)}
    .overlay{
      position:absolute;left:0;right:0;bottom:0;
      padding:14px;
      background: linear-gradient(to top, rgba(0,0,0,.62), rgba(0,0,0,0));
    }
    .title{
      margin:0;
      font-size:13px;
      font-weight:600;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .meta{
      margin-top:4px;
      font-size:12px;
      color: rgba(245,246,248,.72);
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .hash{
      position:absolute;right:10px;bottom:10px;z-index:2;
      font-size:11px;
      padding:7px 10px;border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
    }

    /* Map page */
    .map-grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:12px;
    }
    @media (max-width: 900px){ .map-grid{grid-template-columns:1fr} }
    .map-wrap{padding:12px}
    .map-embed{
      width:100%;
      aspect-ratio: 16/10;
      border:1px solid var(--border);
      border-radius: 18px;
      overflow:hidden;
      background: rgba(0,0,0,.20);
    }
    iframe{border:0;width:100%;height:100%}
    .shootlog{padding:14px}
    .log-item{
      border:1px solid var(--border);
      background: rgba(255,255,255,.04);
      border-radius: 18px;
      padding:12px;
      margin-top:10px;
    }
    .log-item h4{margin:0 0 6px;font-size:13px}
    .log-item p{margin:0;color:var(--muted);font-size:13px;line-height:1.45}

    /* Lightbox */
    .lb{
      position:fixed;inset:0;z-index:99;
      background: rgba(0,0,0,.78);
      backdrop-filter: blur(6px);
      display:none;
      padding: 14px;
    }
    .lb.open{display:grid;place-items:center}
    .lb-box{
      width:min(1120px, 100%);
      border-radius: 26px;
      border:1px solid var(--border);
      background: rgba(6,7,10,.92);
      overflow:hidden;
      box-shadow: var(--shadow);
      display:grid;
      grid-template-columns: 1.6fr .9fr;
    }
    @media (max-width: 920px){ .lb-box{grid-template-columns:1fr} }
    .lb-img{
      background:#000;
      display:grid;place-items:center;
      min-height: 54vh;
      position:relative;
    }
    .lb-img img{
      width:100%;
      height: 58vh;
      object-fit: contain;
      background:#000;
      display:block;
    }
    .lb-side{padding:14px;display:flex;flex-direction:column;gap:12px}
    .lb-top{display:flex;align-items:flex-start;justify-content:space-between;gap:10px}
    .lb-top h3{margin:0;font-size:15px;line-height:1.25}
    .lb-top .sub{margin:6px 0 0;font-size:12px;color:var(--muted2)}
    .lb-actions{display:flex;gap:8px;align-items:center}
    .iconbtn{
      width:38px;height:38px;border-radius: 16px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      color:var(--text);
    }
    .iconbtn:hover{background: rgba(255,255,255,.10);border-color: var(--border2)}
    .tagbox{
      border:1px solid var(--border);
      background: rgba(255,255,255,.05);
      border-radius: 20px;
      padding: 12px;
    }
    .tagbox .label{font-size:12px;color:var(--muted2);margin-bottom:8px}
    .tagbox .tagrow{display:flex;gap:8px;flex-wrap:wrap}
    .kbdtip{
      font-size:11px;color:var(--muted2);
      border:1px solid var(--border);
      border-radius: 16px;
      padding:8px 10px;
      background: rgba(0,0,0,.22);
    }
    .footer{
      border-top:1px solid var(--border);
      background: rgba(6,7,10,.50);
      padding: 18px 0;
      color: var(--muted2);
      font-size: 12px;
    }
    .hide{display:none !important}
  </style>
</head>

<body>
  <header class="topbar">
    <div class="wrap topbar-inner">
      <div class="brand">
        <div class="logo" title="Skylog">‚úàÔ∏è</div>
        <div style="min-width:0">
          <h1 id="brandTitle">Skylog ‚Äî Aviation Photography</h1>
          <p id="brandSubtitle">Clean frames from loud machines.</p>
        </div>
      </div>

      <div class="nav">
        <button class="tab active" id="tabGallery">Gallery</button>
        <button class="tab" id="tabMap">Map</button>
        <a class="btn" id="instagramLink" href="#" target="_blank" rel="noreferrer">üì∑ Instagram ‚Üó</a>
        <a class="btn primary" id="emailLink" href="#">‚úâÔ∏è Contact</a>
      </div>
    </div>
  </header>

  <section class="hero">
    <div class="wrap hero-grid">
      <div>
        <h2>A runway-style gallery that stays out of the way.</h2>
        <p class="sub">
          Search aircraft, filter tags, and open the lightbox to browse like a logbook.
          Map view shows where each shoot happened (pins + quick filters).
        </p>

        <div class="runway" aria-hidden="true">
          <div class="edge"></div>
          <div class="centerline"></div>
          <div class="marker">‚úàÔ∏è</div>
        </div>

        <div class="pillbar" id="quickTags"></div>
      </div>

      <div class="panel controls">
        <div class="row" style="gap:12px">
          <div class="field">
            <label for="q">Search</label>
            <input id="q" placeholder="A-10, airshow, sunset‚Ä¶" />
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <div class="field">
            <label for="tag">Filter</label>
            <select id="tag"></select>
          </div>
          <div class="field">
            <label for="sort">Sort</label>
            <select id="sort">
              <option>Newest</option>
              <option>Oldest</option>
              <option>Aircraft A‚ÜíZ</option>
              <option>Aircraft Z‚ÜíA</option>
            </select>
          </div>
        </div>

        <div class="row" style="margin-top:10px; justify-content:space-between">
          <div class="small" id="countLine">Showing 0 / 0</div>
          <button class="btn" id="resetBtn">Reset</button>
        </div>

        <div class="kbdtip" style="margin-top:10px">
          Tip: In lightbox use <b>‚Üê</b>/<b>‚Üí</b> ‚Ä¢ <b>Esc</b> closes.
        </div>
      </div>
    </div>
  </section>

  <main class="main">
    <div class="wrap">

      <!-- GALLERY PAGE -->
      <section id="pageGallery">
        <div id="gallery" class="gallery"></div>
        <div id="emptyState" class="panel" style="padding:18px;margin-top:12px;display:none;text-align:center;color:var(--muted)">
          No matches. Try a different tag or search term.
        </div>
      </section>

      <!-- MAP PAGE -->
      <section id="pageMap" class="hide">
        <div class="map-grid">
          <div class="panel map-wrap">
            <div class="small" style="margin:4px 0 10px">
              Map pins are easiest with <b>Google My Maps</b>. Replace the iframe URL below with your map‚Äôs share link.
            </div>
            <div class="map-embed" aria-label="Map embed">
              <iframe id="mapFrame" loading="lazy"
                src="https://www.google.com/maps/d/embed?mid=YOUR_MYMAP_ID_HERE"
                referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>
          </div>

          <div class="panel shootlog">
            <div style="display:flex;align-items:center;justify-content:space-between;gap:10px">
              <div>
                <div style="font-weight:600">Shoot log</div>
                <div class="small">Tap a location to filter shots.</div>
              </div>
              <button class="btn" id="jumpToGalleryBtn">View filtered in Gallery ‚Üí</button>
            </div>

            <div class="pillbar" id="locationChips" style="margin-top:12px"></div>

            <div id="logList"></div>
          </div>
        </div>
      </section>

    </div>
  </main>

  <!-- LIGHTBOX -->
  <div class="lb" id="lightbox" role="dialog" aria-modal="true" aria-label="Photo viewer">
    <div class="lb-box" id="lbBox">
      <div class="lb-img">
        <button class="iconbtn" id="prevBtn" title="Previous (‚Üê)" style="position:absolute;left:10px;top:10px">‚Üê</button>
        <button class="iconbtn" id="nextBtn" title="Next (‚Üí)" style="position:absolute;right:10px;top:10px">‚Üí</button>
        <img id="lbImg" alt="" />
      </div>

      <div class="lb-side">
        <div class="lb-top">
          <div style="min-width:0">
            <h3 id="lbTitle">Title</h3>
            <div class="sub" id="lbMeta">meta</div>
          </div>
          <div class="lb-actions">
            <a class="iconbtn" id="openFullBtn" title="Open full image" target="_blank" rel="noreferrer"
               style="display:grid;place-items:center;text-decoration:none;">‚Üó</a>
            <button class="iconbtn" id="closeBtn" title="Close (Esc)">‚úï</button>
          </div>
        </div>

        <div class="tagbox">
          <div class="label">Tags</div>
          <div class="tagrow" id="lbTags"></div>
        </div>

        <div class="kbdtip">Esc closes ‚Ä¢ ‚Üê/‚Üí browse</div>
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="wrap" style="display:flex;gap:12px;flex-wrap:wrap;justify-content:space-between;align-items:center">
      <div>¬© <span id="year"></span> <span id="footerTitle">Skylog ‚Äî Aviation Photography</span></div>
      <div>Built for quick browsing ‚Äî because nobody wants a 12-step preflight just to see pictures.</div>
    </div>
  </footer>

  <script>
    // =========================
    // 1) EDIT THIS SECTION
    // =========================
    const BRAND = {
      title: "Skylog ‚Äî Aviation Photography",
      subtitle: "Clean frames from loud machines.",
      instagram: "https://instagram.com/",
      email: "mailto:hello@example.com",
    };

    // Put your photos here. For each photo:
    // - src: image URL (or /photos/filename.jpg if you host images alongside this file)
    // - tags: array of strings
    // - location: keep consistent names if you want clean location filters
    const PHOTOS = [
  {
    id: "shot-1",
    src: "photos/DSC_0240-Enhanced-NR-2-DeNoiseAI-standard-2.jpg",
    title: "Low Pass Moment",
    aircraft: "Unknown Aircraft",
    location: "Miami, FL",
    date: "2026-02-01",
    tags: ["aviation", "sunset"]
  },
  {
    id: "shot-2",
    src: "photos/DSC_7453-Enhanced-NR-DeNoiseAI-standard.jpg",
    title: "Climb Out",
    aircraft: "Unknown Aircraft",
    location: "Jacksonville, FL",
    date: "2026-02-02",
    tags: ["departure", "golden-hour"]
  }
];

    // Optional: simple ‚Äúshoot log‚Äù entries on the Map page.
    // You can match these to your map pins (same location names).
    const SHOOT_LOG = [
      { location: "Miami, FL", notes: "Golden hour patterns, lots of GA training traffic." },
      { location: "Jacksonville, FL", notes: "Ramp shots + departures. Great light near sunset." },
      { location: "Airshow", notes: "Fast jets + loud smiles. Bring earpro, always." },
    ];

    // Google My Maps embed:
    // Replace the iframe src in HTML with your My Maps embed link.
    // Example format:
    // https://www.google.com/maps/d/embed?mid=YOUR_MYMAP_ID
    // =========================

    // Helpers
    const $ = (id) => document.getElementById(id);
    const prettyDate = (iso) => {
      if (!iso) return "";
      try {
        const d = new Date(iso);
        return d.toLocaleDateString(undefined, { year:"numeric", month:"short", day:"numeric" });
      } catch { return iso; }
    };
    const tinyHash = (str="") => {
      let h=0;
      for (let i=0;i<str.length;i++) h = (h*31 + str.charCodeAt(i)) >>> 0;
      return h % 360;
    };

    // State
    let state = {
      tab: "gallery",
      query: "",
      tag: "All",
      sort: "Newest",
      location: "All", // for map chips
      active: null,
      filtered: [],
      lbIndex: -1,
    };

    // Init brand
    function initBrand(){
      $("brandTitle").textContent = BRAND.title;
      $("brandSubtitle").textContent = BRAND.subtitle;
      $("footerTitle").textContent = BRAND.title;
      $("instagramLink").href = BRAND.instagram;
      $("emailLink").href = BRAND.email;
      $("year").textContent = new Date().getFullYear();
    }

    // Build tag list
    function allTags(){
      const set = new Set();
      PHOTOS.forEach(p => (p.tags||[]).forEach(t => set.add(t)));
      return ["All", ...Array.from(set).sort((a,b)=>a.localeCompare(b))];
    }

    function allLocations(){
      const set = new Set();
      PHOTOS.forEach(p => p.location && set.add(p.location));
      return ["All", ...Array.from(set).sort((a,b)=>a.localeCompare(b))];
    }

    // Render tag dropdown + quick tags
    function renderTagControls(){
      const tags = allTags();
      const sel = $("tag");
      sel.innerHTML = tags.map(t => `<option>${t}</option>`).join("");
      sel.value = state.tag;

      const quick = $("quickTags");
      const quickList = tags.slice(0,7);
      quick.innerHTML = quickList.map(t => {
        const hue = tinyHash(t);
        return `
          <button class="pill ${state.tag===t?'active':''}" data-qtag="${t}">
            <span class="dot" style="background:hsl(${hue} 70% 60% / .9)"></span>
            ${t}
          </button>`;
      }).join("") + (tags.length>7 ? `<span class="pill" style="cursor:default;opacity:.9">+${tags.length-7} more in filter</span>`:"");

      quick.querySelectorAll("[data-qtag]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          state.tag = btn.getAttribute("data-qtag");
          $("tag").value = state.tag;
          applyAndRender();
        });
      });
    }

    // Filter + sort
    function applyFilters(){
      const q = state.query.trim().toLowerCase();
      let out = PHOTOS.filter(p=>{
        const text = [p.title, p.aircraft, p.location, (p.tags||[]).join(" ")].filter(Boolean).join(" ").toLowerCase();
        const hitQ = !q || text.includes(q);
        const hitTag = state.tag==="All" || (p.tags||[]).includes(state.tag);
        const hitLoc = state.location==="All" || p.location===state.location;
        return hitQ && hitTag && hitLoc;
      });

      out.sort((a,b)=>{
        const da = a.date ? new Date(a.date).getTime() : 0;
        const db = b.date ? new Date(b.date).getTime() : 0;
        if (state.sort==="Newest") return db-da;
        if (state.sort==="Oldest") return da-db;
        if (state.sort==="Aircraft A‚ÜíZ") return (a.aircraft||"").localeCompare(b.aircraft||"");
        if (state.sort==="Aircraft Z‚ÜíA") return (b.aircraft||"").localeCompare(a.aircraft||"");
        return 0;
      });

      state.filtered = out;
    }

    // Render gallery
    function renderGallery(){
      const g = $("gallery");
      const empty = $("emptyState");

      $("countLine").textContent = `Showing ${state.filtered.length} / ${PHOTOS.length}`;

      if (state.filtered.length === 0){
        g.innerHTML = "";
        empty.style.display = "block";
        return;
      }
      empty.style.display = "none";

      g.innerHTML = state.filtered.map(p=>{
        const firstTag = (p.tags && p.tags[0]) ? p.tags[0] : "photo";
        return `
          <article class="card" data-id="${p.id}">
            <div class="stamp"><span class="beacon"></span><span style="min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${p.aircraft||"Aircraft"}</span></div>
            <img class="thumb" src="${p.src}" alt="${escapeHtml(p.title||"Photo")}" loading="lazy" />
            <div class="overlay">
              <p class="title">${escapeHtml(p.title||"")}</p>
              <div class="meta">${escapeHtml(p.location||"")}${p.location && p.date ? " ‚Ä¢ ":""}${p.date?prettyDate(p.date):""}</div>
            </div>
            <div class="hash">#${escapeHtml(firstTag)}</div>
          </article>
        `;
      }).join("");

      g.querySelectorAll(".card").forEach(card=>{
        card.addEventListener("click", ()=>{
          const id = card.getAttribute("data-id");
          openLightboxById(id);
        });
      });
    }

    // Escape for safety
    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, (c)=>({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[c]));
    }

    // Lightbox
    function openLightboxById(id){
      const idx = state.filtered.findIndex(p=>p.id===id);
      if (idx<0) return;
      state.lbIndex = idx;
      state.active = state.filtered[idx];
      renderLightbox();
      $("lightbox").classList.add("open");
      document.body.style.overflow = "hidden";
    }

    function closeLightbox(){
      $("lightbox").classList.remove("open");
      document.body.style.overflow = "";
      state.active = null;
      state.lbIndex = -1;
    }

    function goLightbox(dir){
      if (state.lbIndex < 0 || state.filtered.length===0) return;
      const next = (state.lbIndex + dir + state.filtered.length) % state.filtered.length;
      state.lbIndex = next;
      state.active = state.filtered[next];
      renderLightbox();
    }

    function renderLightbox(){
      const p = state.active;
      if (!p) return;

      $("lbImg").src = p.src;
      $("lbImg").alt = p.title || "Photo";
      $("lbTitle").textContent = p.title || "";
      $("lbMeta").textContent = `${p.aircraft||"Aircraft"}${p.location? " ‚Ä¢ "+p.location:""}${p.date? " ‚Ä¢ "+prettyDate(p.date):""}`;
      $("openFullBtn").href = p.src;

      const tags = p.tags || [];
      const box = $("lbTags");
      box.innerHTML = tags.length ? tags.map(t=>{
        const hue = tinyHash(t);
        const active = (state.tag===t);
        return `
          <button class="pill ${active?'active':''}" data-lbtag="${t}">
            <span class="dot" style="background:hsl(${hue} 70% 60% / .9)"></span>
            ${escapeHtml(t)}
          </button>
        `;
      }).join("") : `<span class="small">‚Äî</span>`;

      box.querySelectorAll("[data-lbtag]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const t = btn.getAttribute("data-lbtag");
          state.tag = t;
          $("tag").value = t;
          closeLightbox();
          applyAndRender();
        });
      });
    }

    // Tabs
    function setTab(tab){
      state.tab = tab;
      $("tabGallery").classList.toggle("active", tab==="gallery");
      $("tabMap").classList.toggle("active", tab==="map");
      $("pageGallery").classList.toggle("hide", tab!=="gallery");
      $("pageMap").classList.toggle("hide", tab!=="map");
      window.scrollTo({top:0,behavior:"smooth"});
    }

    // Map page: chips + log
    function renderMapPage(){
      // Location chips
      const locs = allLocations();
      const wrap = $("locationChips");
      wrap.innerHTML = locs.map(l=>{
        const hue = tinyHash(l);
        return `
          <button class="pill ${state.location===l?'active':''}" data-loc="${escapeHtml(l)}">
            <span class="dot" style="background:hsl(${hue} 70% 60% / .9)"></span>
            ${escapeHtml(l)}
          </button>
        `;
      }).join("");

      wrap.querySelectorAll("[data-loc]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          state.location = btn.getAttribute("data-loc");
          renderMapPage(); // refresh chip highlight
          applyAndRender(); // filter state.filtered too
          renderShootLog();
        });
      });

      renderShootLog();
    }

    function renderShootLog(){
      const list = $("logList");
      const loc = state.location;
      const entries = (loc==="All")
        ? SHOOT_LOG
        : SHOOT_LOG.filter(x=>x.location===loc);

      list.innerHTML = entries.map(e=>`
        <div class="log-item">
          <h4>${escapeHtml(e.location)}</h4>
          <p>${escapeHtml(e.notes)}</p>
          <div class="small" style="margin-top:8px">
            Matching photos: <b>${countPhotosForLocation(e.location)}</b>
          </div>
        </div>
      `).join("") || `
        <div class="log-item">
          <h4>No log entries</h4>
          <p>Add entries in <b>SHOOT_LOG</b> for this location.</p>
        </div>
      `;
    }

    function countPhotosForLocation(location){
      return PHOTOS.filter(p=>p.location===location).length;
    }

    // Apply everything
    function applyAndRender(){
      applyFilters();
      renderTagControls();
      renderGallery();
      renderMapPage();
    }

    // Wire controls
    function bindUI(){
      $("q").addEventListener("input", (e)=>{
        state.query = e.target.value;
        applyAndRender();
      });

      $("tag").addEventListener("change", (e)=>{
        state.tag = e.target.value;
        applyAndRender();
      });

      $("sort").addEventListener("change", (e)=>{
        state.sort = e.target.value;
        applyAndRender();
      });

      $("resetBtn").addEventListener("click", ()=>{
        state.query = "";
        state.tag = "All";
        state.sort = "Newest";
        state.location = "All";
        $("q").value = "";
        $("tag").value = "All";
        $("sort").value = "Newest";
        applyAndRender();
      });

      $("tabGallery").addEventListener("click", ()=>setTab("gallery"));
      $("tabMap").addEventListener("click", ()=>setTab("map"));

      $("jumpToGalleryBtn").addEventListener("click", ()=>{
        setTab("gallery");
        // (state.location is already set) ‚Äî gallery will already be filtered by it
      });

      // Lightbox controls
      $("closeBtn").addEventListener("click", closeLightbox);
      $("prevBtn").addEventListener("click", ()=>goLightbox(-1));
      $("nextBtn").addEventListener("click", ()=>goLightbox(1));
      $("lightbox").addEventListener("click", (e)=>{
        if (e.target === $("lightbox")) closeLightbox();
      });

      // Keyboard
      window.addEventListener("keydown", (e)=>{
        if (e.key === "Escape") closeLightbox();
        if (!$("lightbox").classList.contains("open")) return;
        if (e.key === "ArrowLeft") goLightbox(-1);
        if (e.key === "ArrowRight") goLightbox(1);
      });
    }

    // Boot
    initBrand();
    bindUI();
    applyAndRender();
  </script>
</body>
</html>
